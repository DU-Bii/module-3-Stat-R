<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Leslie REGAD et Frédéric GUYON (Université Paris Diderot)" />

<meta name="date" content="2019-02-27" />

<title>Module 3 - Analyse statistique avec R - Séance 6</title>

<script src="TP_seance6_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="TP_seance6_files/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="TP_seance6_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="TP_seance6_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="TP_seance6_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="TP_seance6_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="TP_seance6_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="TP_seance6_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="TP_seance6_files/navigation-1.1/tabsets.js"></script>
<script src="TP_seance6_files/navigation-1.1/codefolding.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #303030; color: #cccccc; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; }
td.sourceCode { padding-left: 5px; }
pre, code { color: #cccccc; background-color: #303030; }
code > span.kw { color: #f0dfaf; } /* Keyword */
code > span.dt { color: #dfdfbf; } /* DataType */
code > span.dv { color: #dcdccc; } /* DecVal */
code > span.bn { color: #dca3a3; } /* BaseN */
code > span.fl { color: #c0bed1; } /* Float */
code > span.ch { color: #dca3a3; } /* Char */
code > span.st { color: #cc9393; } /* String */
code > span.co { color: #7f9f7f; } /* Comment */
code > span.ot { color: #efef8f; } /* Other */
code > span.al { color: #ffcfaf; } /* Alert */
code > span.fu { color: #efef8f; } /* Function */
code > span.er { color: #c3bf9f; } /* Error */
code > span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */
code > span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
code > span.sc { color: #dca3a3; } /* SpecialChar */
code > span.vs { color: #cc9393; } /* VerbatimString */
code > span.ss { color: #cc9393; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { } /* Variable */
code > span.cf { color: #f0dfaf; } /* ControlFlow */
code > span.op { color: #f0efd0; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
code > span.at { } /* Attribute */
code > span.do { color: #7f9f7f; } /* Documentation */
code > span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
code > span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
code > span.in { color: #7f9f7f; font-weight: bold; } /* Information */
div.sourceCode {
  overflow-x: visible;
}
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Module 3 - Analyse statistique avec R - Séance 6</h1>
<h3 class="subtitle"><em>DUBii 2019</em></h3>
<h4 class="author"><em>Leslie REGAD et Frédéric GUYON (Université Paris Diderot)</em></h4>
<h4 class="date"><em>2019-02-27</em></h4>

</div>


<p>Le but de ce TP est de développer des modèles statistiques pour prédire le type de cancer en utilisant les données de l’étude TCGA (<em>The Cancer Genome Atlas</em>; <a href="https://cancergenome.nih.gov/" class="uri">https://cancergenome.nih.gov/</a>) qui regroupent des données RNA-seq de patients atteints du cancer du sein.</p>
<p>Pour ce TP, vous utiliserez les mêmes données que celles que vous avez utilisées pour le TP clustering (séance 4) :</p>
<ul>
<li>fichier <code>BIC_log2-norm-counts_edgeR_DEG_top_1000.tsv.gz</code> qui correspond au fichier d’expression pour les 1000 gènes (lignes) les plus significatifs pour 819 échantillons (colonnes).<br />
</li>
<li>fichier <code>BIC_sample-classes.tsv.gz</code> qui contient les étiquettes des 819 échantillons.</li>
</ul>
<p>Sur le serveur Rstudio de l’IFB-core-cluster, les données sont dans le répertoire : <code>/shared/projects/du_bii_2019/data/module3/seance4/BIC/</code></p>
<p>Au cours de ce TP, vous allez développer différents modèles statistiques :</p>
<ul>
<li>Dans un premier temps, vous construirez des modèles pour prédire si le cancer est du type “lumina.A” ou pas en utilisant :
<ul>
<li>un modèle CART,<br />
</li>
<li>un modèle de <em>random forest</em>,<br />
</li>
<li>un modèle de SVM,<br />
</li>
</ul></li>
<li>Dans un second temps, vous construirez un modèle de <em>random forest</em> pour prédire un des 4 types de cancer : Basal.like, HER2pos, Luminal.A ou Luminal.B.</li>
</ul>
<div id="preparation-des-donnees" class="section level1">
<h1><span class="header-section-number">1</span> Préparation des données</h1>
<ol style="list-style-type: decimal">
<li>Ouvrez le fichier d’expression des gènes en utilisant la commande <code>read.table()</code>. Stockez ce data.frame dans l’objet <code>BIC.expr</code>. Vérifiez la taille du data.frame généré en utilisant la commande <code>dim()</code>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data.folder&lt;-<span class="st">&quot;../../projects/du_bii_2019/data/module3/seance4/BIC/&quot;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">BIC.expr.file &lt;-<span class="st"> </span><span class="kw">file.path</span>(data.folder, <span class="st">&quot;BIC_log2-norm-counts_edgeR_DEG_top_1000.tsv.gz&quot;</span>)
BIC.expr &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">file =</span> BIC.expr.file, <span class="dt">header =</span> <span class="ot">TRUE</span>)
<span class="kw">dim</span>(BIC.expr)</code></pre></div>
<pre><code>[1] 1000  819</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Ouvrez le fichier qui contient les étiquettes des échantillons en utilisant la commande <code>read.table()</code>. Stockez ce data.frame dans l’objet <code>BIC.sample.classes</code>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">BIC.sample.classes &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="kw">file.path</span>(data.folder, <span class="st">&quot;BIC_sample-classes.tsv.gz&quot;</span>),<span class="dt">header =</span> <span class="ot">TRUE</span>)</code></pre></div>
<ul>
<li>Vérifiez le nombre d’échantillons disponibles dans ce jeu de données.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(BIC.sample.classes)</code></pre></div>
<pre><code>[1] 819   4</code></pre>
<ul>
<li>Déterminez le type de variables disponibles dans ce jeu de données en utilisant la fonction <code>summary()</code>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(BIC.sample.classes)</code></pre></div>
<pre><code>       cancer.type        ER1            PR1            Her2    
 Basal.like  :131   Negative:184   Negative:267   Negative:631  
 HER2pos     : 41   Positive:635   Positive:552   Positive:188  
 Luminal.A   :422                                               
 Luminal.B   :118                                               
 Unclassified:107                                               </code></pre>
<p>La première colonne du data.frame <code>BIC.sample.classes</code> renseigne sur le type de cancer de chaque échantillon. Comme vous pouvez le voir, il y a 5 types de cancer, dont un type qui est <code>Unclassified</code>. Lors de la prédiction du type de cancer, ce type risque de biaiser les résultats. Vous allez supprimer ces échantillons des jeux de données.<br />
A la fin du TP, vous utiliserez les modèles statistiques construits pour prédire le type de cancer de ces échantillons de type “Unclassified”.</p>
<ol start="3" style="list-style-type: decimal">
<li>Supprimez les échantillons correspondant au type <code>Unclassified</code> dans les deux data.frames.</li>
</ol>
<ul>
<li>En utilisant la fonction <code>which()</code>, identifiez les lignes du data.frame <code>BIC.sample.classes</code> qui correspondent au type <code>Unclassified</code>. Vérifiez que vous avez bien sélectionné 107 individus.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ind.uncl &lt;-<span class="st"> </span><span class="kw">which</span>(BIC.sample.classes[,<span class="st">&quot;cancer.type&quot;</span>]<span class="op">==</span><span class="st">&quot;Unclassified&quot;</span>)
<span class="kw">length</span>(ind.uncl)</code></pre></div>
<pre><code>[1] 107</code></pre>
<ul>
<li>Supprimez ces individus dans le data.frame <code>BIC.sample.classes</code> en utilisant l’indexation négative. Vérifiez la taille du nouveau data.frame.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">BIC.sample.classes.<span class="dv">4</span> &lt;-<span class="st"> </span>BIC.sample.classes[<span class="op">-</span>ind.uncl,]
<span class="kw">dim</span>(BIC.sample.classes.<span class="dv">4</span>)</code></pre></div>
<pre><code>[1] 712   4</code></pre>
<ul>
<li>Supprimez les échantillons correspondant au type <code>Unclassified</code> du data.frame <code>BIC.expr</code>. Attention, dans le data.frame <code>BIC.expr</code> les échantillons sont présentés en colonnes.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">BIC.expr.<span class="dv">4</span> &lt;-<span class="st"> </span>BIC.expr[, <span class="op">-</span>ind.uncl] 
<span class="kw">dim</span>(BIC.expr.<span class="dv">4</span>)</code></pre></div>
<pre><code>[1] 1000  712</code></pre>
<ul>
<li>Pour construire les premiers modèles, vous n’allez pas utiliser les quatre types de cancers, mais seulement deux :
<ul>
<li>Luminal.A,<br />
</li>
<li>non Luminal.A : qui correspondent aux autres types. Vous allez donc transformer la colonne <code>cancer.type</code> du data.frame <code>BIC.sample.classes.2</code> en une variable qualitative à deux classes : “Luminal.A” ou “no.Luminal.A”.</li>
</ul></li>
</ul>
<ol style="list-style-type: lower-alpha">
<li>Créez le vecteur <code>new.type</code> qui contient 712 fois (<code>nrow(BIC.sample.classes.2)</code>) la valeur “Luminal.A”.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new.type &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;Luminal.A&quot;</span>, <span class="dt">length =</span> <span class="kw">nrow</span>(BIC.sample.classes.<span class="dv">4</span>))</code></pre></div>
<ol start="2" style="list-style-type: lower-alpha">
<li>Identifiez les individus qui ne contiennent pas “Luminal.A” dans la première colonne (colonne <code>cancer.type</code>) du data.frame <code>BIC.sample.classes.4</code>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ind.noLA &lt;-<span class="st"> </span><span class="kw">which</span>(BIC.sample.classes.<span class="dv">4</span>[,<span class="st">&quot;cancer.type&quot;</span>]<span class="op">!=</span><span class="st">&quot;Luminal.A&quot;</span>)</code></pre></div>
<ol start="3" style="list-style-type: lower-alpha">
<li>Pour ces individus, assignez la valeur “no.Luminal.A” au vecteur <code>new.type</code>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new.type[ind.noLA] =<span class="st"> &quot;no.Luminal.A&quot;</span></code></pre></div>
<ol start="4" style="list-style-type: lower-alpha">
<li>Remplacez la colonne <code>cancer.type</code> du data.frame <code>BIC.sample.classes.2</code> par le vecteur <code>new.type</code> que vous aurez transformé en facteur (fonction <code>as.factor()</code>)</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">BIC.sample.classes.<span class="dv">2</span> &lt;-<span class="st"> </span>BIC.sample.classes.<span class="dv">4</span>
BIC.sample.classes.<span class="dv">2</span>[,<span class="st">&quot;cancer.type&quot;</span>] =<span class="st"> </span><span class="kw">as.factor</span>(new.type)</code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Suppression des variables corrélées</li>
</ol>
<p>Une des étapes du nettoyage du jeu de données correspond à supprimer les variables (ici les gènes) corrélées. Pour cela, vous allez utiliser la fonction <code>findCorrelation()</code> de la librairie <code>caret</code>. Cette fonction prend en entrée la matrice de corrélation entre les variables et le seuil de corrélation à partir duquel on considère que deux variables sont corrélées.</p>
<ul>
<li>Calculez la matrice de corrélation entre les gènes différentiellement exprimés. Comme dans le data.frame <code>BIC.expr.4</code> les gènes sont en lignes, pensez à transposer votre data.frame.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mat.cor &lt;-<span class="st"> </span><span class="kw">cor</span>(<span class="kw">t</span>(BIC.expr.<span class="dv">4</span>))</code></pre></div>
<ul>
<li>Identifiez les gènes à supprimer en utilisant un seuil de corrléation de 0.8 et la fonction <code>findCorrelation()</code>. Combien de gènes allez vous supprimer.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(caret)
var.supp =<span class="st"> </span><span class="kw">findCorrelation</span>(mat.cor, <span class="dt">cutoff =</span> <span class="fl">0.8</span>)
<span class="kw">length</span>(var.supp)</code></pre></div>
<pre><code>[1] 36</code></pre>
<ul>
<li>Supprimez ces gènes du data.frame <code>BIC.expr.4</code>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">BIC.expr.<span class="dv">4</span> &lt;-<span class="st"> </span>BIC.expr.<span class="dv">4</span>[<span class="op">-</span>var.supp,]
<span class="kw">dim</span>(BIC.expr.<span class="dv">4</span>)</code></pre></div>
<pre><code>[1] 964 712</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Pour créer les modèles de prédiction, il est nécessaire d’avoir un data.frame qui regroupe pour chaque échantillon les gènes et son type de cancer.</li>
</ol>
<ul>
<li>Créez le data.frame <code>df.data</code> qui contient :
<ul>
<li>en lignes ; les échantillons<br />
</li>
<li>en colonnes : les gènes et le type de cancer.<br />
Pour cela, utilisez la commande <code>data.frame()</code>.<br />
</li>
<li>La première colonne de votre data.frame <code>df.data</code> doit correspondre aux types de cancer.<br />
</li>
<li>les colonnes 2 à 965 doivent correspondre aux gènes.</li>
</ul></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df.data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(BIC.sample.classes.<span class="dv">2</span>[,<span class="dv">1</span>], <span class="kw">t</span>(BIC.expr.<span class="dv">4</span>))</code></pre></div>
<ul>
<li>Assignez “cancer.type” comme nom de colonne à la première colonne de <code>df.data</code>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colnames</span>(df.data)[<span class="dv">1</span>] &lt;-<span class="st"> &quot;cancer.type&quot;</span></code></pre></div>
</div>
<div id="preparation-des-echantillons-dapprentissage-et-de-test" class="section level1">
<h1><span class="header-section-number">2</span> Préparation des échantillons d’apprentissage et de test</h1>
<ul>
<li>L’<strong>échantillon d’apprentissage</strong> est l’échantillon qui va permettre d’apprendre les modèles. Il sera constitué de 2/3 des échantillons sélectionnés de manière aléatoire.<br />
</li>
<li>L’<strong>échantillon de test</strong> est l’échantillon qui va permettre d’estimer les performances non biaisées des modèles. Il sera constitué du 1/3 des échantillons restant.</li>
</ul>
<ol style="list-style-type: decimal">
<li>En utilisant la fonction <code>sample()</code> créez un vecteur qui contient le numéro d’indice de 2/3 des individus choisis aléatoirement. Ces individus vont constituter les individus du jeu d’apprentissage.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ind.app &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(df.data), <span class="dt">size=</span><span class="dv">2</span><span class="op">/</span><span class="dv">3</span><span class="op">*</span><span class="kw">nrow</span>(df.data))</code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Créez le data.frame <code>mat.app</code> qui contient les valeurs d’expression des gènes et le type de cancer pour les individus choisis aléatoirement. Cette matrice correspond au jeu d’apprentissage.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mat.app &lt;-<span class="st"> </span>df.data[ind.app,]
<span class="kw">dim</span>(mat.app)</code></pre></div>
<pre><code>[1] 474 965</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Créez le data.frame <code>mat.test</code> qui contient les valeurs d’expression de gènes et le type de cancer pour les individus restants (1/3). Cette matrice correspond au jeu test.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mat.test &lt;-<span class="st"> </span>df.data[<span class="op">-</span>ind.app,]
<span class="kw">dim</span>(mat.test)</code></pre></div>
<pre><code>[1] 238 965</code></pre>
</div>
<div id="validation-des-deux-echantillons." class="section level1">
<h1><span class="header-section-number">3</span> Validation des deux échantillons.</h1>
<ol style="list-style-type: decimal">
<li>Calculez une analyse en composantes principale en utilisant le data.frame <code>df.data</code>. Pour cela, utilisez la fonction <code>PCA()</code> de la librairie <code>FactoMineR</code>. Pensez à ne pas prendre en compte la colonne renseignant sur le type de cancer car ce n’est pas une variable quantitative.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(FactoMineR)
pca.res &lt;-<span class="st"> </span><span class="kw">PCA</span>(df.data[,<span class="op">-</span><span class="dv">1</span>], <span class="dt">graph=</span><span class="ot">FALSE</span>)</code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Créez un vecteur <code>vcol.set</code> qui contiendra les couleurs associés à chaque indidivu suivant s’il appartient au jeu d’apprentissage (en magenta) ou au jeu test (en bleu). Pour cela, :</li>
</ol>
<ul>
<li>Créez le vecteur <code>vcol.set</code> qui contient 712 fois (<code>nrow(df.data)</code>) la couleur bleu.<br />
</li>
<li>Dans ce vecteur, remplacez la valeur “bleu” des individus appartenant à l’échantillon d’apprentissage (<code>ind.app</code>) par la valeur “magenta”.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vcol.set &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;blue&quot;</span>, <span class="dt">length =</span> <span class="kw">nrow</span>(df.data))
vcol.set[ind.app] &lt;-<span class="st"> &quot;magenta&quot;</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Représentez la projection des individus sur les 2 premières composantes principales en colorant les individus suivant l’échantillon auquel ils appartiennent.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(pca.res, <span class="dt">col.ind =</span> vcol.set, <span class="dt">label=</span><span class="st">&quot;none&quot;</span>)
<span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="dt">legend=</span><span class="kw">c</span>(<span class="st">&quot;jeu d&#39;apprentissage&quot;</span>, <span class="st">&quot;jeu test&quot;</span>), <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;magenta&quot;</span>), <span class="dt">pch=</span><span class="dv">19</span>)</code></pre></div>
<p><img src="figures/07_tests_multiplesunnamed-chunk-23-1.png" width="672" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Déterminez la répartition des deux types de cancer dans les échantillons d’apprentissage et test.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>))
<span class="kw">barplot</span>(<span class="kw">table</span>(mat.app[,<span class="st">&quot;cancer.type&quot;</span>]), <span class="dt">main=</span><span class="st">&quot;jeu d&#39;apprentissage&quot;</span>)
<span class="kw">barplot</span>(<span class="kw">table</span>(mat.test[,<span class="st">&quot;cancer.type&quot;</span>]), <span class="dt">main=</span><span class="st">&quot;jeu de test&quot;</span>)</code></pre></div>
<p><img src="figures/07_tests_multiplesunnamed-chunk-24-1.png" width="672" style="display: block; margin: auto;" /> D’après les résultats obtenus, concluez sur la validité les échantillons d’apprentissage et test. Si vous concluez au fait que les deux échantillons ne sont pas valides, alors reprenez la procédure pour générer à nouveau des échantillons d’apprentissage et de test.</p>
</div>
<div id="prediction-du-type-de-cancer-en-utilisant-une-approche-de-cart" class="section level1">
<h1><span class="header-section-number">4</span> Prédiction du type de cancer en utilisant une approche de CART</h1>
<ol style="list-style-type: decimal">
<li>A partir des données de l’échantillon d’apprentissage (<code>mat.app</code>), construisez un modèle de CART permettant de prédire le type de cancer (2 classes) en fonction de l’expression des gènes. Pour cela, utilisez la fonction <code>rpart()</code> de la librairie <code>rpart</code>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rpart)
<span class="kw">library</span>(rpart.plot)

rpart.fit &lt;-<span class="kw">rpart</span>(cancer.type<span class="op">~</span>., <span class="dt">data =</span> mat.app)
rpart.fit</code></pre></div>
<pre><code>n= 474 

node), split, n, loss, yval, (yprob)
      * denotes terminal node

  1) root 474 187 Luminal.A (0.60548523 0.39451477)  
    2) ENSG00000029725.16&gt;=18.9784 377  98 Luminal.A (0.74005305 0.25994695)  
      4) ENSG00000043143.20&gt;=17.38587 347  73 Luminal.A (0.78962536 0.21037464)  
        8) ENSG00000034152.18&lt; 18.71317 331  61 Luminal.A (0.81570997 0.18429003)  
         16) ENSG00000008838.18&lt; 20.24429 317  51 Luminal.A (0.83911672 0.16088328)  
           32) ENSG00000025156.12&lt; 16.90443 298  40 Luminal.A (0.86577181 0.13422819)  
             64) ENSG00000066735.14&lt; 15.74111 241  20 Luminal.A (0.91701245 0.08298755)  
              128) ENSG00000010704.18&lt; 17.86318 233  15 Luminal.A (0.93562232 0.06437768) *
              129) ENSG00000010704.18&gt;=17.86318 8   3 no.Luminal.A (0.37500000 0.62500000) *
             65) ENSG00000066735.14&gt;=15.74111 57  20 Luminal.A (0.64912281 0.35087719)  
              130) ENSG00000006712.14&gt;=18.49866 42   8 Luminal.A (0.80952381 0.19047619)  
                260) ENSG00000042753.11&lt; 18.88345 35   3 Luminal.A (0.91428571 0.08571429) *
                261) ENSG00000042753.11&gt;=18.88345 7   2 no.Luminal.A (0.28571429 0.71428571) *
              131) ENSG00000006712.14&lt; 18.49866 15   3 no.Luminal.A (0.20000000 0.80000000) *
           33) ENSG00000025156.12&gt;=16.90443 19   8 no.Luminal.A (0.42105263 0.57894737) *
         17) ENSG00000008838.18&gt;=20.24429 14   4 no.Luminal.A (0.28571429 0.71428571) *
        9) ENSG00000034152.18&gt;=18.71317 16   4 no.Luminal.A (0.25000000 0.75000000) *
      5) ENSG00000043143.20&lt; 17.38587 30   5 no.Luminal.A (0.16666667 0.83333333)  
       10) ENSG00000036549.12&lt; 17.71504 8   3 Luminal.A (0.62500000 0.37500000) *
       11) ENSG00000036549.12&gt;=17.71504 22   0 no.Luminal.A (0.00000000 1.00000000) *
    3) ENSG00000029725.16&lt; 18.9784 97   8 no.Luminal.A (0.08247423 0.91752577) *</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>En utilisant la fonction <code>prp()</code> de la librairie <code>rpart.plot()</code>, représentez le modèle obtenu.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prp</span>(rpart.fit, <span class="dt">extra=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="figures/07_tests_multiplesunnamed-chunk-26-1.png" width="672" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Sur les données de l’échantillon d’apprentissage calculez l’<em>accuracy</em> du modèle (=le taux de bien prédit) (<span class="math inline">\(Acc = \frac{VP+VN}{VP+VN+FP+FN}\)</span>) .</li>
</ol>
<ul>
<li>En utilisant la fonction <code>predict()</code>, prédisez le type de cancer pour chaque individu de l’échantillon d’apprentissage. N’oubliez pas de préciser l’argument <code>type=&quot;class&quot;</code> pour préciser que vous faites de la classification. Stockez ces valeurs prédites dans le vecteur <code>pred.app</code>.<br />
Attention, la fonction <code>predict()</code>est une fonction générique. Dans ce cas, vous utilisez la fonction <code>predict()</code> appliquée à un objet <code>rpart</code>. Pour avoir plus d’informations sur les arguments de la fonction, vous devez utiliser l’aide de la fonction <code>predict.rpart()</code>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pred.app &lt;-<span class="st"> </span><span class="kw">predict</span>(rpart.fit, <span class="dt">newdata =</span> mat.app, <span class="dt">type=</span><span class="st">&quot;class&quot;</span>)</code></pre></div>
<ul>
<li>A l’aide de la fonction <code>table()</code>, calculez la matrice de confusion entre les données prédites sur l’échantillon d’apprentissage (contenues dans le vecteur <code>pred.app</code>) et les vraies valeurs (contenues dans la colonne <code>cancer.type</code> du data.frame <code>mat.app</code>).</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tc.rpart.app &lt;-<span class="st"> </span><span class="kw">table</span>(pred.app, mat.app[,<span class="st">&quot;cancer.type&quot;</span>])
tc.rpart.app</code></pre></div>
<pre><code>              
pred.app       Luminal.A no.Luminal.A
  Luminal.A          255           21
  no.Luminal.A        32          166</code></pre>
<ul>
<li>Calculez l’<em>accuracy</em> du modèle sur les données de l’apprentissage</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">acc.rpart.app &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">diag</span>(tc.rpart.app))<span class="op">/</span><span class="kw">sum</span>(tc.rpart.app)
acc.rpart.app</code></pre></div>
<pre><code>[1] 0.8881857</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>En utilisant la même procédure que celle utilisée pour calculer l’<em>accuracy</em> sur le jeu d’apprentissage, calculez l’<em>accuracy</em> du modèle sur l’échantillon test</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pred.test &lt;-<span class="st"> </span><span class="kw">predict</span>(rpart.fit, <span class="dt">newdata =</span> mat.test, <span class="dt">type=</span><span class="st">&quot;class&quot;</span>)

tc.rpart.test &lt;-<span class="st"> </span><span class="kw">table</span>(pred.test, mat.test[,<span class="st">&quot;cancer.type&quot;</span>])
tc.rpart.test</code></pre></div>
<pre><code>              
pred.test      Luminal.A no.Luminal.A
  Luminal.A           94           25
  no.Luminal.A        41           78</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">acc.rpart.test &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">diag</span>(tc.rpart.test))<span class="op">/</span><span class="kw">sum</span>(tc.rpart.test)
acc.rpart.test</code></pre></div>
<pre><code>[1] 0.7226891</code></pre>
<p>En comparant les performances obtenues sur l’échantillon d’apprentissage et de test, vous constatez que les performances obtenues sur l’échantillon d’apprentissage (Acc=0.89) sont plus grandes que celles obtenues sur l’échantillon test (Acc=0.72). Ainsi, vous observez un <strong>phénomène de sur-apprentissage</strong>. Le modèle apprend très bien les données de l’échantillon d’apprentissage, mais prédit moins bien les données du jeu test.<br />
Pour diminuer ce sur-apprentissage, une des solutions serait d’élaguer l’arbre, c’est-à-dire d’enlever certaines branches. Ainsi, le nouveau modèle obtenu serait moins performant sur les données d’apprentissage, mais plus performant sur les données du jeu test.</p>
</div>
<div id="prediction-du-type-de-cancer-en-utilisant-une-approche-de-random-forest" class="section level1">
<h1><span class="header-section-number">5</span> Prédiction du type de cancer en utilisant une approche de <em>random forest</em></h1>
<ol style="list-style-type: decimal">
<li>A partir des données de l’échantillon d’apprentissage, construisez une forêt aléatoire permettant de prédire le type de cancer (2 types) en fonction de l’expression des gènes.</li>
</ol>
<ul>
<li>Pour cela, utilisez la fonction <code>randomForest()</code> de la librairie <code>randomForest</code> avec les paramètres <code>mtry</code> et <code>mtree</code> par défaut. Stockez le modèle dans l’objet <code>rf.fit</code>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(randomForest)
rf.fit &lt;-<span class="st"> </span><span class="kw">randomForest</span>(cancer.type<span class="op">~</span>., <span class="dt">data =</span> mat.app)</code></pre></div>
<ul>
<li>Affichez à l’écran le modèle créé.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rf.fit</code></pre></div>
<pre><code>
Call:
 randomForest(formula = cancer.type ~ ., data = mat.app) 
               Type of random forest: classification
                     Number of trees: 500
No. of variables tried at each split: 31

        OOB estimate of  error rate: 18.14%
Confusion matrix:
             Luminal.A no.Luminal.A class.error
Luminal.A          268           19  0.06620209
no.Luminal.A        67          120  0.35828877</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Choix de la valeur du paramètre <code>ntree</code>.</li>
</ol>
<ul>
<li>L’objet <code>rf.fit</code> créé est une liste qui contient plusieurs éléments. L’élement <code>err.rate</code> contient les erreurs commises par le modèle contenant <span class="math inline">\(m\)</span> arbres Représentez le taux d’erreur (<em>Misclassification Rate</em>) en fonction du nombre d’arbres présentant dans la forêt.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(rf.fit<span class="op">$</span>err.rate[,<span class="dv">1</span>], <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;nombre d&#39;arbre dans la foret&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;taux d&#39;erreur&quot;</span>)</code></pre></div>
<p><img src="figures/07_tests_multiplesunnamed-chunk-30-1.png" width="672" style="display: block; margin: auto;" /></p>
<ul>
<li>A partir de ce graphique, choisissez le nombre d’arbres optimal, noté <span class="math inline">\(ntree_{opt}\)</span>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ntree.opt &lt;-<span class="st"> </span><span class="dv">200</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Choix de la valeur optimale pour le paramètre <code>mtry</code>.<br />
Remarque : cette étape est coûteuse en temps de calculs.</li>
</ol>
<p>Pour trouver la valeur optimale de <code>mtry</code>, vous allez calculer plusieurs modèles en variant la valeur du paramètre <code>mtry</code>. Pour chaque modèle l’erreur commise par le modèle sera stockée dans un vecteur. La valeur optimale de <code>mtry</code> correspondra à la valeur du <code>mtry</code> du modèle donnant le plus faible taux d’erreur.</p>
<ul>
<li>Calculez les modèles pour des valeurs de <code>mtry</code> de 15, 30, 62, 124, 248, 350, 500, et la valeur de <code>ntree</code> optimale. Le taux d’erreur de chaque modèle sera stockée dans le vecteur <code>v.err</code>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">v.err &lt;-<span class="st">  </span><span class="ot">NULL</span>
v.mtry &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">15</span>, <span class="dv">31</span>, <span class="dv">62</span>, <span class="dv">124</span>, <span class="dv">248</span>, <span class="dv">350</span>, <span class="dv">500</span>)
<span class="cf">for</span>(i <span class="cf">in</span> v.mtry){
    <span class="kw">set.seed</span>(<span class="dv">123</span>)
    rf.fit &lt;-<span class="st"> </span><span class="kw">randomForest</span>(cancer.type<span class="op">~</span>., <span class="dt">data =</span> mat.app, <span class="dt">ntree=</span>ntree.opt, <span class="dt">mtry=</span>i)
    v.err &lt;-<span class="st"> </span><span class="kw">c</span>(v.err, rf.fit<span class="op">$</span>err.rate[ntree.opt,<span class="dv">1</span>])
}</code></pre></div>
<ul>
<li>Représentez graphiquement les erreurs commises par les modèles en fonction de la valeur de <code>mtry</code>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(v.mtry, v.err, <span class="dt">type =</span><span class="st">&quot;b&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;mtry values&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;taux d&#39;erreur&quot;</span>, <span class="dt">xaxt=</span><span class="st">&quot;n&quot;</span>)
<span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at=</span>v.mtry, <span class="dt">labels=</span>v.mtry, <span class="dt">las=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="figures/07_tests_multiplesunnamed-chunk-33-1.png" width="672" style="display: block; margin: auto;" /></p>
<ul>
<li>A partir de ce graphique, déterminez la valeur optimale de <code>mtry</code>.</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>Calcul du modèle avec les paramètres optimaux.</li>
</ol>
<ul>
<li>Calculez le modèle <em>random forest</em> sur l’échantillon d’apprentissage en utilisant les valeurs optimales des paramètres <code>mtry</code> et <code>ntree</code>. Dans la fonction <code>randomForest()</code>, ajouter l’argument <code>importance=TRUE</code>. Cet argument vous permettra de stocker l’importance des variables.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rf.fit &lt;-<span class="st"> </span><span class="kw">randomForest</span>(cancer.type<span class="op">~</span>., <span class="dt">data =</span> mat.app, <span class="dt">ntree=</span>ntree.opt, <span class="dt">mtry=</span><span class="dv">248</span>, <span class="dt">importance=</span><span class="ot">TRUE</span>)</code></pre></div>
<ul>
<li>Visualisez le modèle et la table de confusion obtenue sur les échantillons OOB.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rf.fit</code></pre></div>
<pre><code>
Call:
 randomForest(formula = cancer.type ~ ., data = mat.app, ntree = ntree.opt,      mtry = 248, importance = TRUE) 
               Type of random forest: classification
                     Number of trees: 200
No. of variables tried at each split: 248

        OOB estimate of  error rate: 16.67%
Confusion matrix:
             Luminal.A no.Luminal.A class.error
Luminal.A          267           20  0.06968641
no.Luminal.A        59          128  0.31550802</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Calcul des performances du modèle <em>random forest</em></li>
</ol>
<p>Pour comparer les performances de ce modèle, avec le modèle CART calculé précédemment, il faut calculer l’<em>accuracy</em> du modèle <code>rf.fit</code> sur les données des échantillons d’apprentissage et de test.</p>
<ul>
<li>Calculez l’<em>accuracy</em> du modèle sur les données de l’apprentissage</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Prédiction du type de cancer des individus du jeu d&#39;apprentissage</span>
pred.app &lt;-<span class="st"> </span><span class="kw">predict</span>(rf.fit, <span class="dt">newdata =</span> mat.app, <span class="dt">type=</span><span class="st">&quot;class&quot;</span>)

<span class="co"># matrice de confusion entre les données prédites sur l&#39;échantillon d&#39;apprentissage et les vraies valeurs.</span>

tc.rf.app &lt;-<span class="st"> </span><span class="kw">table</span>(pred.app, mat.app[,<span class="st">&quot;cancer.type&quot;</span>])
tc.rf.app</code></pre></div>
<pre><code>              
pred.app       Luminal.A no.Luminal.A
  Luminal.A          287            0
  no.Luminal.A         0          187</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#  accuracy* du modèle sur les données de l&#39;apprentissage</span>
acc.rf.app &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">diag</span>(tc.rf.app))<span class="op">/</span><span class="kw">sum</span>(tc.rf.app)
acc.rf.app</code></pre></div>
<pre><code>[1] 1</code></pre>
<ul>
<li>Calcul de l’<em>accuracy</em> sur l’échantillon test</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># prediction</span>
pred.test &lt;-<span class="st"> </span><span class="kw">predict</span>(rf.fit, <span class="dt">newdata =</span> mat.test, <span class="dt">type=</span><span class="st">&quot;class&quot;</span>)

<span class="co"># table de confusion</span>
tc.rf.test &lt;-<span class="st"> </span><span class="kw">table</span>(pred.test, mat.test[,<span class="st">&quot;cancer.type&quot;</span>])
tc.rf.test</code></pre></div>
<pre><code>              
pred.test      Luminal.A no.Luminal.A
  Luminal.A          128           35
  no.Luminal.A         7           68</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#accuracy</span>
acc.rf.test &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">diag</span>(tc.rf.test))<span class="op">/</span><span class="kw">sum</span>(tc.rf.test)
acc.rf.test</code></pre></div>
<pre><code>[1] 0.8235294</code></pre>
<ol start="4" style="list-style-type: decimal">
<li><p>Comparez les performances des modèles de CART et de Random forest.</p></li>
<li><p>Etude de l’importance des variables (ici les gènes) dans le modèle.</p></li>
</ol>
<ul>
<li>Représentez graphiquement l’importance de chaque gène en utilisant la fonction <code>varImpPlot()</code></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">varImpPlot</span>(rf.fit, <span class="dt">n.var=</span><span class="dv">50</span>, <span class="dt">cex =</span> <span class="fl">0.7</span>, <span class="dt">type=</span><span class="dv">1</span>)</code></pre></div>
<p><img src="figures/07_tests_multiplesunnamed-chunk-37-1.png" width="672" style="display: block; margin: auto;" /></p>
<ul>
<li><p>Identifiez les gènes qui permettent de différentier le cancer Luminal.A des autres cancers.</p></li>
<li><p>Pour chaque gene sélectionné, tracez la distribution de l’expression du gène chez les patients atteints d’un cancer de type Luminal.A et chez les autres patients d’après les données d’apprentissage.</p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">v.imp &lt;-<span class="st"> </span><span class="kw">importance</span>(rf.fit)[,<span class="st">&quot;MeanDecreaseAccuracy&quot;</span>]
gene.sel &lt;-<span class="st"> </span><span class="kw">names</span>(<span class="kw">which</span>(v.imp<span class="op">&gt;</span><span class="dv">4</span>))

<span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">3</span>))
<span class="cf">for</span>(gene <span class="cf">in</span> gene.sel){
  <span class="kw">boxplot</span>(mat.app[,gene]<span class="op">~</span>mat.app[,<span class="dv">1</span>],<span class="dt">col=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>), <span class="dt">main=</span>gene)
}</code></pre></div>
<p><img src="figures/07_tests_multiplesunnamed-chunk-38-1.png" width="672" style="display: block; margin: auto;" /><img src="figures/07_tests_multiplesunnamed-chunk-38-2.png" width="672" style="display: block; margin: auto;" /></p>
<ul>
<li>Représentez la matrice des données en focalisant sur les gènes sélectionnées et en utilisant une heatmap.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Trier les individus par type de cancer</span>
ind.app.lA &lt;-<span class="st"> </span><span class="kw">which</span>(mat.app[,<span class="st">&quot;cancer.type&quot;</span>]<span class="op">==</span><span class="st">&quot;Luminal.A&quot;</span>)
ind.tri &lt;-<span class="st"> </span><span class="kw">c</span>(ind.app.lA, <span class="kw">setdiff</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(mat.app), ind.app.lA))
mat.app.tri &lt;-<span class="st"> </span><span class="kw">t</span>(mat.app[ind.tri, gene.sel])

<span class="co"># Compute mean value per gene</span>
gene.means &lt;-<span class="st"> </span><span class="kw">apply</span>(mat.app.tri, <span class="dv">1</span>, mean)
gene.sd &lt;-<span class="st">  </span><span class="kw">apply</span>(mat.app.tri, <span class="dv">1</span>, sd)

<span class="co"># Compute gene-wise centered expression values</span>
BIC.expr.genes.centered &lt;-<span class="st"> </span>mat.app.tri <span class="op">-</span><span class="st"> </span>gene.means

<span class="co"># Compute gene-wise centred + scaled expression values</span>
BIC.expr.genes.standardized &lt;-<span class="st"> </span>BIC.expr.genes.centered <span class="op">/</span><span class="st"> </span>gene.sd

## define a Blue - White - Red palette
frenchflag.palette &lt;-<span class="st"> </span><span class="kw">colorRampPalette</span>(<span class="kw">c</span>(<span class="st">&#39;dark blue&#39;</span>,<span class="st">&#39;white&#39;</span>,<span class="st">&#39;dark red&#39;</span>))

## Define a green - black - red palette
GBR.palette &lt;-<span class="st"> </span><span class="kw">colorRampPalette</span>(<span class="kw">c</span>(<span class="st">&#39;green&#39;</span>,<span class="st">&#39;black&#39;</span>,<span class="st">&#39;red&#39;</span>))

<span class="kw">heatmap</span>(<span class="kw">as.matrix</span>(BIC.expr.genes.standardized),
        <span class="dt">zlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">4</span>,<span class="dv">4</span>), <span class="dt">Colv=</span><span class="ot">NA</span>,
        <span class="dt">distfun =</span> <span class="cf">function</span>(x) <span class="kw">as.dist</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">cor</span>(<span class="kw">t</span>(x), <span class="dt">method =</span> <span class="st">&quot;spearman&quot;</span>)), 
        <span class="dt">hclustfun =</span> <span class="cf">function</span>(x) <span class="kw">hclust</span>(x, <span class="dt">method =</span> <span class="st">&quot;ward.D2&quot;</span>),
        <span class="dt">labRow =</span> <span class="ot">NA</span>, <span class="dt">labCol =</span> <span class="ot">NA</span>,  <span class="co"># DO not print the labels (unreadable anyway)</span>
        <span class="dt">col =</span> <span class="kw">GBR.palette</span>(<span class="dv">100</span>),
        <span class="dt">scale =</span> <span class="st">&quot;none&quot;</span>)</code></pre></div>
<p><img src="figures/07_tests_multiplesstandardize_genes-1.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<div id="prediction-du-type-de-cancer-en-utilisant-les-support-vecteur-machines" class="section level1">
<h1><span class="header-section-number">6</span> Prédiction du type de cancer en utilisant les Support Vecteur Machines</h1>
<ul>
<li>utilisation avec formule R</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(e1071)
model=<span class="kw">svm</span>(cancer.type<span class="op">~</span>., <span class="dt">data=</span>mat.app)</code></pre></div>
<ul>
<li>utilisation classique</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">X=<span class="kw">subset</span>(mat.app, <span class="dt">select =</span> <span class="op">-</span>cancer.type)
y=mat.app<span class="op">$</span>cancer.type
model=<span class="kw">svm</span>(X,y)</code></pre></div>
<ul>
<li>erreur d’apprentissage avec les paramètres par défaut</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pred=<span class="kw">predict</span>(model, X)
<span class="kw">table</span>(pred, mat.app<span class="op">$</span>cancer.type)</code></pre></div>
<ul>
<li>surapprentissage avec gaussiennes très resserrées</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model=<span class="kw">svm</span>(X,y,<span class="dt">gamma=</span><span class="fl">0.1</span>)
pred=<span class="kw">predict</span>(model, X)
<span class="kw">table</span>(pred, mat.app<span class="op">$</span>cancer.type)</code></pre></div>
<ul>
<li>surapprentissage avec cost élevé</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model=<span class="kw">svm</span>(X,y,<span class="dt">cost=</span><span class="dv">100</span>)
pred=<span class="kw">predict</span>(model, X)
<span class="kw">table</span>(pred, mat.app<span class="op">$</span>cancer.type)</code></pre></div>
<ul>
<li>évaluation d’erreur de test (en surapprentissage)</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Xtest=<span class="kw">subset</span>(mat.test, <span class="dt">select =</span> <span class="op">-</span>cancer.type)
pred=<span class="kw">predict</span>(model, Xtest)
<span class="kw">table</span>(pred, mat.test<span class="op">$</span>cancer.type)</code></pre></div>
<ul>
<li>évaluation d’erreur de test (avec paramètres par défaut)</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model=<span class="kw">svm</span>(X,y)
pred=<span class="kw">predict</span>(model, Xtest)
<span class="kw">table</span>(pred, mat.test<span class="op">$</span>cancer.type)</code></pre></div>
</div>
<div id="prediction-des-echantillons-classes-comme-unclassified" class="section level1">
<h1><span class="header-section-number">7</span> Prédiction des échantillons classés comme “Unclassified”</h1>
<p>Lors de l’étude du jeu de données initial, vous avez déterminé que 107 échantillons avaient été classés comme “Unclassified”. En utilisant les modèles de <em>random forest</em> et de SVM, prédisez le type de cancer pour ces individus. Comparez les résultats obtenus avec les deux modèles.</p>
<ul>
<li>Prédiction du type de cancer en utilisant le modèle <em>random forest</em></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mat.pred &lt;-<span class="st"> </span><span class="kw">t</span>(BIC.expr)
pred.uncl.rf &lt;-<span class="st"> </span><span class="kw">predict</span>(rf.fit, <span class="dt">newdata =</span> mat.pred[ind.uncl,])
<span class="kw">table</span>(pred.uncl.rf)</code></pre></div>
<pre><code>pred.uncl.rf
   Luminal.A no.Luminal.A 
          58           49 </code></pre>
<ul>
<li>Prédiction du type de cancer en utilisant le modèle SVM</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pred.uncl.svm &lt;-<span class="st"> </span><span class="kw">predict</span>(model, <span class="dt">newdata =</span> mat.pred[ind.uncl,])
<span class="kw">table</span>(pred.uncl.svm)</code></pre></div>
<pre><code>pred.uncl.svm
   Luminal.A no.Luminal.A 
          70           37 </code></pre>
<ul>
<li>Calcul de la table de confusion entre les deux vecteurs de prédiction.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tc &lt;-<span class="st"> </span><span class="kw">table</span>(pred.uncl.rf, pred.uncl.svm)
tc</code></pre></div>
<pre><code>              pred.uncl.svm
pred.uncl.rf   Luminal.A no.Luminal.A
  Luminal.A           56            2
  no.Luminal.A        14           35</code></pre>
<p># Prédiction des 4 types de cancer.</p>
<ol style="list-style-type: decimal">
<li>Préparation du jeu de données</li>
</ol>
<p>Créez un nouveau data.frame (<code>df.data.4</code>) qui contient les données d’expression de gènes contenu dans le data.frame <code>BIC.expr.4</code> et le type de cancer pour chaque échantillon (définit en 4 types).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df.data.<span class="dv">4</span> &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">as.character</span>(BIC.sample.classes.<span class="dv">4</span>[,<span class="dv">1</span>]), <span class="kw">t</span>(BIC.expr.<span class="dv">4</span>))
df.data.<span class="dv">4</span>[,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">as.factor</span>(df.data.<span class="dv">4</span>[,<span class="dv">1</span>])
<span class="kw">colnames</span>(df.data.<span class="dv">4</span>)[<span class="dv">1</span>] &lt;-<span class="st"> &quot;cancer.type&quot;</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Préparation des échantillons d’apprentissage et de test</li>
</ol>
<ul>
<li>En reprenant les individus sélectionnés pour la création de l’échantillon d’apprentissage <code>ind.app</code>, créez les data.frames <code>mat.app.4</code> et <code>mat.test.4</code> qui contiennent les données de l’échantillon d’apprentissage et celui de test.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mat.app.<span class="dv">4</span> &lt;-<span class="st"> </span>df.data.<span class="dv">4</span>[ind.app,]
<span class="kw">dim</span>(mat.app.<span class="dv">4</span>)</code></pre></div>
<pre><code>[1] 474 965</code></pre>
<ul>
<li>Préparez l’échantillon test</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mat.test.<span class="dv">4</span> &lt;-<span class="st"> </span>df.data.<span class="dv">4</span>[<span class="op">-</span>ind.app,]
<span class="kw">dim</span>(mat.test.<span class="dv">4</span>)</code></pre></div>
<pre><code>[1] 238 965</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Déterminez les paramètres <code>mtry</code> et <code>ntree</code> optimaux pour le random forest permettant de prédire les 4 types de cancer.</li>
</ol>
<ul>
<li>Déterminez la valeur optimale du paramètre <code>ntree</code>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rf.fit.<span class="dv">4</span> &lt;-<span class="st"> </span><span class="kw">randomForest</span>(cancer.type<span class="op">~</span>., <span class="dt">data=</span>mat.app.<span class="dv">4</span>)
<span class="kw">plot</span>(rf.fit.<span class="dv">4</span><span class="op">$</span>err.rate[,<span class="dv">1</span>], <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;taux d&#39;erreur&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;nombre d&#39;arbres&quot;</span>)</code></pre></div>
<p><img src="figures/07_tests_multiplesunnamed-chunk-52-1.png" width="672" style="display: block; margin: auto;" /></p>
<ul>
<li>Déterminez la valeur optimale du paramètre <code>mtry</code>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">v.err &lt;-<span class="st">  </span><span class="ot">NULL</span>
v.mtry &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">15</span>, <span class="dv">31</span>, <span class="dv">62</span>, <span class="dv">124</span>, <span class="dv">248</span>, <span class="dv">350</span>, <span class="dv">500</span>)
<span class="cf">for</span>(i <span class="cf">in</span> v.mtry){
    <span class="kw">set.seed</span>(<span class="dv">123</span>)
    rf.fit &lt;-<span class="st"> </span><span class="kw">randomForest</span>(cancer.type<span class="op">~</span>., <span class="dt">data =</span> mat.app.<span class="dv">4</span>, <span class="dt">ntree=</span><span class="dv">150</span>, <span class="dt">mtry=</span>i)
    v.err &lt;-<span class="st"> </span><span class="kw">c</span>(v.err, rf.fit<span class="op">$</span>err.rate[<span class="dv">150</span>,<span class="dv">1</span>])
}

<span class="kw">plot</span>(v.mtry, v.err, <span class="dt">type =</span><span class="st">&quot;b&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;mtry values&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;taux d&#39;erreur&quot;</span>, <span class="dt">xaxt=</span><span class="st">&quot;n&quot;</span>)
<span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at=</span>v.mtry, <span class="dt">labels=</span>v.mtry, <span class="dt">las=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="figures/07_tests_multiplesunnamed-chunk-53-1.png" width="672" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Calculez le modèle avec les paramètres optimaux.<br />
Calculez à nouveau le modèle sur l’échantillon d’apprentissage en utilisant les valeurs optimales des paramètres <code>mtry</code> et <code>ntree</code>. Dans la fonction <code>randomForest()</code>, ajouter l’argument <code>importance=TRUE</code>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rf.fit.<span class="dv">4</span> &lt;-<span class="st"> </span><span class="kw">randomForest</span>(cancer.type<span class="op">~</span>., <span class="dt">data =</span> mat.app.<span class="dv">4</span>, <span class="dt">ntree=</span><span class="dv">150</span>, <span class="dt">mtry=</span><span class="dv">124</span>, <span class="dt">importance=</span><span class="ot">TRUE</span>)</code></pre></div>
<ul>
<li>Visualisez le modèle et la table de confusion obtenue sur les échantillons OOB.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rf.fit.<span class="dv">4</span></code></pre></div>
<pre><code>
Call:
 randomForest(formula = cancer.type ~ ., data = mat.app.4, ntree = 150,      mtry = 124, importance = TRUE) 
               Type of random forest: classification
                     Number of trees: 150
No. of variables tried at each split: 124

        OOB estimate of  error rate: 22.36%
Confusion matrix:
           Basal.like HER2pos Luminal.A Luminal.B class.error
Basal.like         71       1         9         0  0.12345679
HER2pos             8       2        11         7  0.92857143
Luminal.A           1       0       283         3  0.01393728
Luminal.B           1       0        65        12  0.84615385</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Calculez les performances du modèle <em>random forest</em> sur l’échantillon d’apprentissage et de test.</li>
</ol>
<ul>
<li>Calcul de l’<em>accuracy</em> sur l’échantillon d’apprentissage.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pred.app.<span class="dv">4</span> &lt;-<span class="st"> </span><span class="kw">predict</span>(rf.fit.<span class="dv">4</span>, <span class="dt">newdata =</span> mat.app.<span class="dv">4</span>, <span class="dt">type=</span><span class="st">&quot;class&quot;</span>)
tc.rf4.app &lt;-<span class="st"> </span><span class="kw">table</span>(pred.app.<span class="dv">4</span>, mat.app.<span class="dv">4</span>[,<span class="st">&quot;cancer.type&quot;</span>])
tc.rf4.app</code></pre></div>
<pre><code>            
pred.app.4   Basal.like HER2pos Luminal.A Luminal.B
  Basal.like         81       0         0         0
  HER2pos             0      28         0         0
  Luminal.A           0       0       287         0
  Luminal.B           0       0         0        78</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">acc.rf4.app &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">diag</span>(tc.rf4.app))<span class="op">/</span><span class="kw">sum</span>(tc.rf4.app)
acc.rf4.app</code></pre></div>
<pre><code>[1] 1</code></pre>
<ul>
<li>Calcul de l’<em>accuracy</em> sur l’échantillon test</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pred.test.<span class="dv">4</span> &lt;-<span class="st"> </span><span class="kw">predict</span>(rf.fit.<span class="dv">4</span>, <span class="dt">newdata =</span> mat.test.<span class="dv">4</span>, <span class="dt">type=</span><span class="st">&quot;class&quot;</span>)

tc.rf4.test &lt;-<span class="st"> </span><span class="kw">table</span>(pred.test.<span class="dv">4</span>, mat.test.<span class="dv">4</span>[,<span class="st">&quot;cancer.type&quot;</span>])
tc.rf4.test</code></pre></div>
<pre><code>            
pred.test.4  Basal.like HER2pos Luminal.A Luminal.B
  Basal.like         39       8         1         0
  HER2pos             0       2         0         0
  Luminal.A          10       0       132        29
  Luminal.B           1       3         2        11</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">acc.rf4.test &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">diag</span>(tc.rf4.test))<span class="op">/</span><span class="kw">sum</span>(tc.rf4.test)
acc.rf4.test</code></pre></div>
<pre><code>[1] 0.7731092</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>Etude de l’importance des descripteurs dans le modèle.</li>
</ol>
<ul>
<li>Représentez graphiquement la valeur d’importance des différents gènes en utilisant la fonction <code>varImpPlot()</code></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">varImpPlot</span>(rf.fit.<span class="dv">4</span>, <span class="dt">n.var=</span><span class="dv">50</span>, <span class="dt">cex =</span> <span class="fl">0.6</span>, <span class="dt">type=</span><span class="dv">1</span>)</code></pre></div>
<p><img src="figures/07_tests_multiplesunnamed-chunk-57-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
