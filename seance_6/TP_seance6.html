<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Leslie REGAD (Université Paris Diderot)" />

<meta name="date" content="2019-02-26" />

<title>Module 3 - Analyse statistique avec R - Séance 6</title>

<script src="TP_seance6_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="TP_seance6_files/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="TP_seance6_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="TP_seance6_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="TP_seance6_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="TP_seance6_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="TP_seance6_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="TP_seance6_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="TP_seance6_files/navigation-1.1/tabsets.js"></script>
<script src="TP_seance6_files/navigation-1.1/codefolding.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #303030; color: #cccccc; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; }
td.sourceCode { padding-left: 5px; }
pre, code { color: #cccccc; background-color: #303030; }
code > span.kw { color: #f0dfaf; } /* Keyword */
code > span.dt { color: #dfdfbf; } /* DataType */
code > span.dv { color: #dcdccc; } /* DecVal */
code > span.bn { color: #dca3a3; } /* BaseN */
code > span.fl { color: #c0bed1; } /* Float */
code > span.ch { color: #dca3a3; } /* Char */
code > span.st { color: #cc9393; } /* String */
code > span.co { color: #7f9f7f; } /* Comment */
code > span.ot { color: #efef8f; } /* Other */
code > span.al { color: #ffcfaf; } /* Alert */
code > span.fu { color: #efef8f; } /* Function */
code > span.er { color: #c3bf9f; } /* Error */
code > span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */
code > span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
code > span.sc { color: #dca3a3; } /* SpecialChar */
code > span.vs { color: #cc9393; } /* VerbatimString */
code > span.ss { color: #cc9393; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { } /* Variable */
code > span.cf { color: #f0dfaf; } /* ControlFlow */
code > span.op { color: #f0efd0; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
code > span.at { } /* Attribute */
code > span.do { color: #7f9f7f; } /* Documentation */
code > span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
code > span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
code > span.in { color: #7f9f7f; font-weight: bold; } /* Information */
div.sourceCode {
  overflow-x: visible;
}
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Module 3 - Analyse statistique avec R - Séance 6</h1>
<h3 class="subtitle"><em>DUBii 2019</em></h3>
<h4 class="author"><em>Leslie REGAD (Université Paris Diderot)</em></h4>
<h4 class="date"><em>2019-02-26</em></h4>

</div>


<p>Le but de ce TP est de développer des modèles statistiques pour prédire le type de cancer en utilisant les données de l’étude TCGA (<em>The Cancer Genome Atlas</em>; <a href="https://cancergenome.nih.gov/" class="uri">https://cancergenome.nih.gov/</a>) qui regroupent des données RNA-seq de patients atteints du cancer du sein.</p>
<p>Pour ce TP, vous utiliserez les mêmes données que celles que vous avez utilisées pour le TP clustering (séance 4) :</p>
<ul>
<li>fichier <code>BIC_log2-norm-counts_edgeR_DEG_top_1000.tsv.gz</code> qui correspond au fichier d’expression pour les 1000 gènes (lignes) les plus significatifs pour 819 échantillons (colonnes).<br />
</li>
<li>fichier <code>BIC_sample-classes.tsv.gz</code> qui contient les étiquettes des 819 échantillons.</li>
</ul>
<p>Sur le serveur Rstudio de l’IFB-core-cluster, les données sont dans le répertoire : <code>/shared/projects/du_bii_2019/data/module3/seance4/BIC/</code></p>
<p>Au cours de ce TP, vous allez développer différents modèles statistiques :</p>
<ul>
<li>Dans un premier temps, vous construirez des modèles pour prédire si le cancer est du type “lumina.A” ou pas en utilisant :
<ul>
<li>un modèle CART,<br />
</li>
<li>un modèle de <em>random forest</em>,<br />
</li>
<li>un modèle de SVM,<br />
</li>
</ul></li>
<li>Dans un second temps, vous construirez un modèle de <em>random forest</em> pour prédire un des 4 types de cancer : Basal.like, HER2pos, Luminal.A ou Luminal.B.</li>
</ul>
<div id="etape-1-preparation-des-donnees" class="section level1">
<h1><span class="header-section-number">1</span> Etape 1 : Préparation des données</h1>
<ol style="list-style-type: decimal">
<li>Ouvrez le fichier d’expression des gènes en utilisant la commande <code>read.table()</code>. Stockez ce data.frame dans l’objet <code>BIC.expr</code>. Vérifiez la taille du data.frame généré en utilisant la commande <code>dim()</code>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data.folder=<span class="st">&quot;data/BIC/&quot;</span>
BIC.expr.file &lt;-<span class="st"> </span><span class="kw">file.path</span>(data.folder, <span class="st">&quot;BIC_log2-norm-counts_edgeR_DEG_top_1000.tsv.gz&quot;</span>)
BIC.expr &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">file =</span> BIC.expr.file, <span class="dt">header =</span> <span class="ot">TRUE</span>)
<span class="kw">dim</span>(BIC.expr)</code></pre></div>
<pre><code>[1] 1000  819</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Ouvrez le fichier qui contient les étiquettes des échantillons en utilisant la commande <code>read.table()</code>. Stockez ce data.frame dans l’objet <code>BIC.sample.classes</code>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">BIC.sample.classes &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="kw">file.path</span>(data.folder, <span class="st">&quot;BIC_sample-classes.tsv.gz&quot;</span>),<span class="dt">header =</span> <span class="ot">TRUE</span>)</code></pre></div>
<ul>
<li>Vérifiez le nombre d’échantillons disponibles dans ce jeu de données.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(BIC.sample.classes)</code></pre></div>
<pre><code>[1] 819   4</code></pre>
<ul>
<li>Déterminez le type de variables disponibles dans ce jeu de données en utilisant la fonction <code>summary()</code>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(BIC.sample.classes)</code></pre></div>
<pre><code>       cancer.type        ER1            PR1            Her2    
 Basal.like  :131   Negative:184   Negative:267   Negative:631  
 HER2pos     : 41   Positive:635   Positive:552   Positive:188  
 Luminal.A   :422                                               
 Luminal.B   :118                                               
 Unclassified:107                                               </code></pre>
<p>La première colonne du data.frame <code>BIC.sample.classes</code> renseigne sur le type de cancer de chaque échantillon. Comme vous pouvez le voir, il y a 5 types de cancer, dont un type qui est <code>Unclassified</code>. Lors de la prédiction du type de cancer, ce type risque de biaiser les résultats. On va donc supprimer ces échantillons des jeux de données. A la fin du TP, vous utiliserez les modèles statistiques construits pour prédire le type de cancer de ces échantillons.</p>
<ol start="3" style="list-style-type: decimal">
<li>Supprimez les échantillons correspondant au type <code>Unclassified</code> dans les deux data.frames.</li>
</ol>
<ul>
<li>En utilisant la fonction <code>which()</code>, identifiez les lignes du data.frame <code>BIC.sample.classes</code> qui correspondent au type <code>Unclassified</code>. Vérifiez que vous avez bien sélectionné 107 individus.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ind.uncl &lt;-<span class="st"> </span><span class="kw">which</span>(BIC.sample.classes[,<span class="st">&quot;cancer.type&quot;</span>]<span class="op">==</span><span class="st">&quot;Unclassified&quot;</span>)
<span class="kw">length</span>(ind.uncl)</code></pre></div>
<pre><code>[1] 107</code></pre>
<ul>
<li>Supprimez ces individus dans le data.frame <code>BIC.sample.classes</code> en utilisant l’indexation négative. Vérifiez la taille du nouveau data.frame.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">BIC.sample.classes.<span class="dv">4</span> &lt;-<span class="st"> </span>BIC.sample.classes[<span class="op">-</span>ind.uncl,]
<span class="kw">dim</span>(BIC.sample.classes.<span class="dv">4</span>)</code></pre></div>
<pre><code>[1] 712   4</code></pre>
<ul>
<li>Supprimez les échantillons correspondant au type <code>Unclassified</code> du data.frame <code>BIC.expr</code>. Attention, dans le data.frame <code>BIC.expr</code> les échantillons sont présentés en colonnes.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">BIC.expr.<span class="dv">4</span> &lt;-<span class="st"> </span>BIC.expr[, <span class="op">-</span>ind.uncl] 
<span class="kw">dim</span>(BIC.expr.<span class="dv">4</span>)</code></pre></div>
<pre><code>[1] 1000  712</code></pre>
<ul>
<li>Pour construire les modèles, vous n’allez pas utiliser les quatre types de cancers, mais seulement deux :
<ul>
<li>Luminal.A,<br />
</li>
<li>non Luminal.A. Vous allez donc transformer la colonne <code>cancer.type</code> du data.frame <code>BIC.sample.classes.2</code> en une variable qualitative à deux classes : “Luminal.A” ou “no.Luminal.A”.</li>
</ul></li>
<li>Créez le vecteur <code>new.type</code> qui contient 712 fois (<code>nrow(BIC.sample.classes.2)</code>) la valeur “Luminal.A”.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new.type &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;Luminal.A&quot;</span>, <span class="dt">length =</span> <span class="kw">nrow</span>(BIC.sample.classes.<span class="dv">4</span>))</code></pre></div>
<ul>
<li>Identifiez les individus qui ne contiennent pas “Luminal.A” dans la première colonne (colonne <code>cancer.type</code>) du data.frame <code>BIC.sample.classes.4</code>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ind.noLA &lt;-<span class="st"> </span><span class="kw">which</span>(BIC.sample.classes.<span class="dv">4</span>[,<span class="st">&quot;cancer.type&quot;</span>]<span class="op">!=</span><span class="st">&quot;Luminal.A&quot;</span>)</code></pre></div>
<ul>
<li>Pour ces individus, assignez la valeur “no.Luminal.A” au vecteur <code>new.type</code>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new.type[ind.noLA] =<span class="st"> &quot;no.Luminal.A&quot;</span></code></pre></div>
<ul>
<li>remplacez la colonne <code>cancer.type</code> du data.frame <code>BIC.sample.classes.2</code> par le vecteur <code>new.type</code> que vous aurez transformé en facteur (fonction <code>as.factor()</code>)</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">BIC.sample.classes.<span class="dv">2</span> &lt;-<span class="st"> </span>BIC.sample.classes.<span class="dv">4</span>
BIC.sample.classes.<span class="dv">2</span>[,<span class="st">&quot;cancer.type&quot;</span>] =<span class="st"> </span><span class="kw">as.factor</span>(new.type)</code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Suppression des variables corrélées</li>
</ol>
<p>La première étape du nettoyage du jeu de données correspond à supprimer les variables (ici les gènes) corrélées. Pour cela, vous allez utiliser la fonction <code>findCorrelation()</code> du package <code>caret</code>. Cette fonction nécessite en entrée la matrice de corrélation entre les variables et le seuil de corrélation à partir duquel on considère que deux variables sont corrélées.</p>
<ul>
<li>Calculez la matrice de corrélation entre les gènes différentiellement exprimés. Comme dans le data.frame <code>BIC.expr.4</code> les gènes sont en lignes, pensez à transposer votre data.frame.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mat.cor &lt;-<span class="st"> </span><span class="kw">cor</span>(<span class="kw">t</span>(BIC.expr.<span class="dv">4</span>))</code></pre></div>
<ul>
<li>Identifiez les gènes à supprimer en utilisant un seuil de corrléation de 0.8 et la fonction <code>findCorrelation()</code>. Combien de gènes allez vous supprimer.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(caret)
var.supp =<span class="st"> </span><span class="kw">findCorrelation</span>(mat.cor, <span class="dt">cutoff =</span> <span class="fl">0.8</span>)
<span class="kw">length</span>(var.supp)</code></pre></div>
<pre><code>[1] 36</code></pre>
<ul>
<li>Supprimez ces gènes du data.frame <code>BIC.expr</code>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">BIC.expr.<span class="dv">4</span> &lt;-<span class="st"> </span>BIC.expr.<span class="dv">4</span>[<span class="op">-</span>var.supp,]
<span class="kw">dim</span>(BIC.expr.<span class="dv">4</span>)</code></pre></div>
<pre><code>[1] 964 712</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Pour créer les modèles de prédiction, il est nécessaire d’avoir un data.frame qui regroupe pour chaque échantillons les gènes et le type de cancer associé.</li>
</ol>
<ul>
<li>Créez le data.frame <code>df.data</code> qui contient les échantillons en lignes et les gènes ainsi que le type de cancer en colonne. Pour cela, utilisez la commande <code>data.frame()</code>.
<ul>
<li>La première colonne de votre data.frame <code>df.data</code> doit correspondre aux types de cancer.<br />
</li>
<li>les colonnes 2 à 965 doivent correspondre aux gènes.</li>
</ul></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df.data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(BIC.sample.classes.<span class="dv">2</span>[,<span class="dv">1</span>], <span class="kw">t</span>(BIC.expr.<span class="dv">4</span>))</code></pre></div>
<ul>
<li>Assignez “cancer.type” comme nom de colonne à la première colonne de <code>df.data</code>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colnames</span>(df.data)[<span class="dv">1</span>] &lt;-<span class="st"> &quot;cancer.type&quot;</span></code></pre></div>
</div>
<div id="preparation-des-echantillons-dapprentissage-et-de-test" class="section level1">
<h1><span class="header-section-number">2</span> Préparation des échantillons d’apprentissage et de test</h1>
<ul>
<li>L’échantillon d’apprentissage est l’échantillon qui va permettre d’apprendre les modèles. Il sera constitué de 2/3 des échantillons sélectionnés de manière aléatoire.<br />
</li>
<li>L’échantillon de test est l’échantillon qui va permettre d’estimer les performances non biaisées des modèles. Il sera constitué du 1/3 des échantillons restant.</li>
</ul>
<ol style="list-style-type: decimal">
<li>En utilisant la fonction <code>sample()</code> créez un vecteur qui contient le numéro d’indice de 2/3 des individus choisis aléatoirement. Ces individus vont constituter les individus du jeu d’apprentissage.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ind.app &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(df.data), <span class="dt">size=</span><span class="dv">2</span><span class="op">/</span><span class="dv">3</span><span class="op">*</span><span class="kw">nrow</span>(df.data))</code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Créez le data.frame <code>mat.app</code> qui contient les valeurs d’expression des gènes pour les individus choisis aléatoirement. Cette matrice correspond au jeu d’apprentissage.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mat.app &lt;-<span class="st"> </span>df.data[ind.app,]
<span class="kw">dim</span>(mat.app)</code></pre></div>
<pre><code>[1] 474 965</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Créez le data.frame <code>mat.test</code> qui contient les valeurs d’expression de gènes pour les individus restants (1/3). Cette matrice correspond au jeu test.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mat.test &lt;-<span class="st"> </span>df.data[<span class="op">-</span>ind.app,]
<span class="kw">dim</span>(mat.test)</code></pre></div>
<pre><code>[1] 238 965</code></pre>
</div>
<div id="validation-des-deux-echantillons." class="section level1">
<h1><span class="header-section-number">3</span> Validation des deux échantillons.</h1>
<ol style="list-style-type: decimal">
<li>Calculez une analyse en composantes principale en utilisant le data.frame <code>df.data</code>. Pour cela, utilisez la fonction <code>PCA()</code> de la librairie <code>FactoMineR</code>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(FactoMineR)
pca.res &lt;-<span class="st"> </span><span class="kw">PCA</span>(df.data[,<span class="op">-</span><span class="dv">1</span>], <span class="dt">graph=</span><span class="ot">FALSE</span>)</code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Créez un vecteur <code>vcol.set</code> qui contiendra les couleurs associés à chaque indidivu suivant s’il appartient au jeu d’apprentissage (en magenta) ou au jeu test (en bleu). Pour cela, :</li>
</ol>
<ul>
<li>Créez le vecteur <code>vcol.set</code> qui contient 712 fois (<code>nrow(df.data)</code>) la couleur bleu.<br />
</li>
<li>Dans ce vecteur, remplacez la valeur “bleu” des individus appartenant à l’échantillon d’apprentissage (<code>ind.app</code>) par la valeur “magenta”.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vcol.set &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;blue&quot;</span>, <span class="dt">length =</span> <span class="kw">nrow</span>(df.data))
vcol.set[ind.app] &lt;-<span class="st"> &quot;magenta&quot;</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Représentez la projection des individus sur les 2 premières composantes principales en colorant les individus suivant l’échantillon auquel ils appartiennent.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(pca.res, <span class="dt">col.ind =</span> vcol.set, <span class="dt">label=</span><span class="st">&quot;none&quot;</span>)
<span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="dt">legend=</span><span class="kw">c</span>(<span class="st">&quot;jeu d&#39;apprentissage&quot;</span>, <span class="st">&quot;jeu test&quot;</span>), <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;magenta&quot;</span>), <span class="dt">pch=</span><span class="dv">19</span>)</code></pre></div>
<p><img src="figures/07_tests_multiplesunnamed-chunk-21-1.png" width="672" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Déterminez la répartition des deux types de cancer dans les échantillons d’apprentissage et test.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>))
<span class="kw">barplot</span>(<span class="kw">table</span>(mat.app[,<span class="st">&quot;cancer.type&quot;</span>]), <span class="dt">main=</span><span class="st">&quot;jeu d&#39;apprentissage&quot;</span>)
<span class="kw">barplot</span>(<span class="kw">table</span>(mat.test[,<span class="st">&quot;cancer.type&quot;</span>]), <span class="dt">main=</span><span class="st">&quot;jeu de test&quot;</span>)</code></pre></div>
<p><img src="figures/07_tests_multiplesunnamed-chunk-22-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="prediction-du-type-de-cancer-en-utilisant-une-approche-de-cart" class="section level1">
<h1><span class="header-section-number">4</span> Prédiction du type de cancer en utilisant une approche de CART</h1>
<ol style="list-style-type: decimal">
<li>A partir des données de l’échantillon d’apprentissage (<code>mat.app</code>), construisez un modèle de CART permettant de prédire le type de cancer en fonction de l’expression des gènes. Pour cela, utilisez la fonction <code>rpart()</code> du package <code>rpart</code>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rpart)
<span class="kw">library</span>(rpart.plot)

rpart.fit &lt;-<span class="kw">rpart</span>(cancer.type<span class="op">~</span>., <span class="dt">data =</span> mat.app)
rpart.fit</code></pre></div>
<pre><code>n= 474 

node), split, n, loss, yval, (yprob)
      * denotes terminal node

  1) root 474 195 Luminal.A (0.58860759 0.41139241)  
    2) ENSG00000004838.13&gt;=15.44435 255  43 Luminal.A (0.83137255 0.16862745)  
      4) ENSG00000008838.18&lt; 20.52395 244  32 Luminal.A (0.86885246 0.13114754)  
        8) ENSG00000010704.18&lt; 17.86318 235  25 Luminal.A (0.89361702 0.10638298)  
         16) ENSG00000006432.15&gt;=15.06891 226  19 Luminal.A (0.91592920 0.08407080)  
           32) ENSG00000025156.12&lt; 17.01296 216  13 Luminal.A (0.93981481 0.06018519) *
           33) ENSG00000025156.12&gt;=17.01296 10   4 no.Luminal.A (0.40000000 0.60000000) *
         17) ENSG00000006432.15&lt; 15.06891 9   3 no.Luminal.A (0.33333333 0.66666667) *
        9) ENSG00000010704.18&gt;=17.86318 9   2 no.Luminal.A (0.22222222 0.77777778) *
      5) ENSG00000008838.18&gt;=20.52395 11   0 no.Luminal.A (0.00000000 1.00000000) *
    3) ENSG00000004838.13&lt; 15.44435 219  67 no.Luminal.A (0.30593607 0.69406393)  
      6) ENSG00000029725.16&gt;=19.20474 125  61 Luminal.A (0.51200000 0.48800000)  
       12) ENSG00000006744.18&lt; 18.34374 50  13 Luminal.A (0.74000000 0.26000000)  
         24) ENSG00000001461.16&lt; 18.54492 41   6 Luminal.A (0.85365854 0.14634146) *
         25) ENSG00000001461.16&gt;=18.54492 9   2 no.Luminal.A (0.22222222 0.77777778) *
       13) ENSG00000006744.18&gt;=18.34374 75  27 no.Luminal.A (0.36000000 0.64000000)  
         26) ENSG00000014138.8&lt; 16.30313 23   7 Luminal.A (0.69565217 0.30434783)  
           52) ENSG00000070882.12&gt;=16.03959 15   1 Luminal.A (0.93333333 0.06666667) *
           53) ENSG00000070882.12&lt; 16.03959 8   2 no.Luminal.A (0.25000000 0.75000000) *
         27) ENSG00000014138.8&gt;=16.30313 52  11 no.Luminal.A (0.21153846 0.78846154)  
           54) ENSG00000064933.16&lt; 16.46654 21  10 no.Luminal.A (0.47619048 0.52380952)  
            108) ENSG00000050405.13&lt; 19.98392 12   2 Luminal.A (0.83333333 0.16666667) *
            109) ENSG00000050405.13&gt;=19.98392 9   0 no.Luminal.A (0.00000000 1.00000000) *
           55) ENSG00000064933.16&gt;=16.46654 31   1 no.Luminal.A (0.03225806 0.96774194) *
      7) ENSG00000029725.16&lt; 19.20474 94   3 no.Luminal.A (0.03191489 0.96808511) *</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>En utilisant la fonction <code>prp()</code> de la librairie <code>rpart.plot()</code>, représentez le modèle obtenu.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prp</span>(rpart.fit, <span class="dt">extra=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="figures/07_tests_multiplesunnamed-chunk-24-1.png" width="672" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Sur les données de l’échantillon d’apprentissage calculez l’<em>accuracy</em> (=le taux de bien prédit) (<span class="math inline">\(Acc = \frac{VP+VN}{VP+VN+FP+FN}\)</span>) .</li>
</ol>
<ul>
<li>En utilisant la fonction <code>predict()</code>, prédisez le type de cancer pour chaque individu de l’échantillon d’apprentissage. N’oubliez pas de préciser l’argument <code>type=&quot;class&quot;</code> pour préciser que vous faites de la classification. Stockez ces valeurs prédites dans le vecteur <code>pred.app</code>.<br />
Attention, la fonction <code>predict()</code>est une fonction générique. Dans ce cas, vous utilisez la fonction <code>predict()</code> appliquée à un objet <code>rpart</code>. Pour avoir plus d’informations sur les arguments de la fonction, vous devez utiliser l’aide de la fonction <code>predict.rpart()</code>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pred.app &lt;-<span class="st"> </span><span class="kw">predict</span>(rpart.fit, <span class="dt">newdata =</span> mat.app, <span class="dt">type=</span><span class="st">&quot;class&quot;</span>)</code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>A l’aide de la fonction <code>table()</code>, calculez la matrice de confusion entre les données prédites sur l’échantillon d’apprentissage (contenues dans le vecteur <code>pred.app</code>) et les vraies valeurs (contenues dans la colonne <code>cancer.type</code> du data.frame <code>mat.app</code>).</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tc.rpart.app &lt;-<span class="st"> </span><span class="kw">table</span>(pred.app, mat.app[,<span class="st">&quot;cancer.type&quot;</span>])
tc.rpart.app</code></pre></div>
<pre><code>              
pred.app       Luminal.A no.Luminal.A
  Luminal.A          262           22
  no.Luminal.A        17          173</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Calculez l’<em>accuracy</em> sur les données de l’apprentissage</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">acc.rpart.app &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">diag</span>(tc.rpart.app))<span class="op">/</span><span class="kw">sum</span>(tc.rpart.app)
acc.rpart.app</code></pre></div>
<pre><code>[1] 0.9177215</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>En utilisant la même procédure que celle utilisée pour calculer l’<em>accuracy</em> sur le jeu d’apprentissage, calculez l’<em>accuracy</em> sur l’échantillon test</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pred.test &lt;-<span class="st"> </span><span class="kw">predict</span>(rpart.fit, <span class="dt">newdata =</span> mat.test, <span class="dt">type=</span><span class="st">&quot;class&quot;</span>)

tc.rpart.test &lt;-<span class="st"> </span><span class="kw">table</span>(pred.test, mat.test[,<span class="st">&quot;cancer.type&quot;</span>])
tc.rpart.test</code></pre></div>
<pre><code>              
pred.test      Luminal.A no.Luminal.A
  Luminal.A          115           30
  no.Luminal.A        28           65</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">acc.rpart.test &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">diag</span>(tc.rpart.test))<span class="op">/</span><span class="kw">sum</span>(tc.rpart.test)
acc.rpart.test</code></pre></div>
<pre><code>[1] 0.7563025</code></pre>
<p>En comparant les performances obtenues sur l’échantillon d’apprentissage et de test, vous constatez que les performances obtenues sur l’échantillon d’apprentissage (Acc=0.92) sont plus grandes que celles obtenues sur l’échantillon test (Acc=0.76). Ainsi, vous observez un phénomène de sur-apprentissage. Le modèle apprend très bien les données de l’échantillon d’apprentissage, mais prédit moins bien les données du jeu test.<br />
Pour diminuer ce sur-apprentissage, une des solutions serait d’élaguer l’arbre, c’est-à-dire d’enlever certaines branches. Ainsi, le nouveau modèle obtenu serait moins performant sur les données d’apprentissage, mais plus performant sur les données du jeu test.</p>
</div>
<div id="prediction-du-type-de-cancer-en-utilisant-une-approche-de-cart-1" class="section level1">
<h1><span class="header-section-number">5</span> Prédiction du type de cancer en utilisant une approche de CART</h1>
<ol style="list-style-type: decimal">
<li>A partir des données de l’échantillon d’apprentissage, construisez une forêt aléatoire permettant de prédire le type de cancer (2 types) en fonction de l’expression des gènes.</li>
</ol>
<ul>
<li>Pour cela, utilisez la fonction <code>randomForest()</code> du package <code>randomForest</code> avec les paramètres <code>mtry</code> et <code>mtree</code> par défaut. Stockez le modèle dans l’objet <code>rf.fit</code>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(randomForest)
rf.fit &lt;-<span class="st"> </span><span class="kw">randomForest</span>(cancer.type<span class="op">~</span>., <span class="dt">data =</span> mat.app)</code></pre></div>
<ul>
<li>Affichez à l’écran le modèle créé.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rf.fit</code></pre></div>
<pre><code>
Call:
 randomForest(formula = cancer.type ~ ., data = mat.app) 
               Type of random forest: classification
                     Number of trees: 500
No. of variables tried at each split: 31

        OOB estimate of  error rate: 19.62%
Confusion matrix:
             Luminal.A no.Luminal.A class.error
Luminal.A          250           29   0.1039427
no.Luminal.A        64          131   0.3282051</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Choix de la valeur du paramètre <code>ntree</code>.</li>
</ol>
<ul>
<li>L’objet <code>rf.fit</code> créé est une liste qui contient plusieurs éléments. L’élement <code>err.rate</code> contient les erreurs commises par le modèle contenant <span class="math inline">\(m\)</span> arbres Représentez le taux d’erreur (<em>Misclassification Rate</em>) en fonction du nombre d’arbres présentant dans la forêt.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(rf.fit<span class="op">$</span>err.rate[,<span class="dv">1</span>], <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;nombre d&#39;arbre dans la foret&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;taux d&#39;erreur&quot;</span>)</code></pre></div>
<p><img src="figures/07_tests_multiplesunnamed-chunk-28-1.png" width="672" style="display: block; margin: auto;" /></p>
<ul>
<li>A partir de ce graphique, choisissez le nombre d’arbres optimal, noté <span class="math inline">\(ntree_{opt}\)</span>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ntree.opt &lt;-<span class="st"> </span><span class="dv">200</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Choix de la valeur optimal pour le paramètre <code>mtry</code>.<br />
Remarque : cette étape est coûteuse en temps de calculs.</li>
</ol>
<p>Pour trouver la valeur optimal de <code>mtry</code>, vous allez calculer plusieurs modèles en variant la valeur du paramètre <code>mtry</code>. Pour chaque modèle l’erreur commise par le modèle sera stockée dans un vecteur. La valeur optimale de <code>mtry</code> correspondra à la valeur du <code>mtry</code> du modèle donnant le plus faible taux d’erreur.</p>
<ul>
<li>Calculez les modèles pour des valeurs de <code>mtry</code> de 15, 30, 62, 124, 248, 350, 500, et la valeur de <code>ntree</code> optimale. Le taux d’erreur de chaque modèle sera stockée dans le vecteur <code>v.err</code>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">v.err &lt;-<span class="st">  </span><span class="ot">NULL</span>
v.mtry &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">15</span>, <span class="dv">31</span>, <span class="dv">62</span>, <span class="dv">124</span>, <span class="dv">248</span>, <span class="dv">350</span>, <span class="dv">500</span>)
<span class="cf">for</span>(i <span class="cf">in</span> v.mtry){
    <span class="kw">set.seed</span>(<span class="dv">123</span>)
    rf.fit &lt;-<span class="st"> </span><span class="kw">randomForest</span>(cancer.type<span class="op">~</span>., <span class="dt">data =</span> mat.app, <span class="dt">ntree=</span>ntree.opt, <span class="dt">mtry=</span>i)
    v.err &lt;-<span class="st"> </span><span class="kw">c</span>(v.err, rf.fit<span class="op">$</span>err.rate[ntree.opt,<span class="dv">1</span>])
}</code></pre></div>
<ul>
<li>Représentez graphiquement les erreurs commises par les modèles en fonction de la valeur de <code>mtry</code>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(v.mtry, v.err, <span class="dt">type =</span><span class="st">&quot;b&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;mtry values&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;taux d&#39;erreur&quot;</span>, <span class="dt">xaxt=</span><span class="st">&quot;n&quot;</span>)
<span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at=</span>v.mtry, <span class="dt">labels=</span>v.mtry, <span class="dt">las=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="figures/07_tests_multiplesunnamed-chunk-31-1.png" width="672" style="display: block; margin: auto;" /></p>
<ul>
<li>A partir de ce graphique, déterminez la valeur optimale de <code>mtry</code>.</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>Calcul du modèle avec les paramètres optimaux.</li>
</ol>
<ul>
<li>Calculez le modèle <em>random forest</em> sur l’échantillon d’apprentissage en utilisant les valeurs optimales des paramètres <code>mtry</code> et <code>ntree</code>. Dans la fonction <code>randomForest()</code>, ajouter l’argument <code>importance=TRUE</code>. Cet argument vous stocker l’importance des variables.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rf.fit &lt;-<span class="st"> </span><span class="kw">randomForest</span>(cancer.type<span class="op">~</span>., <span class="dt">data =</span> mat.app, <span class="dt">ntree=</span>ntree.opt, <span class="dt">mtry=</span><span class="dv">248</span>, <span class="dt">importance=</span><span class="ot">TRUE</span>)</code></pre></div>
<ul>
<li>Visualisez le modèle et la table de confusion obtenue sur les échantillons OOB.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rf.fit</code></pre></div>
<pre><code>
Call:
 randomForest(formula = cancer.type ~ ., data = mat.app, ntree = ntree.opt,      mtry = 248, importance = TRUE) 
               Type of random forest: classification
                     Number of trees: 200
No. of variables tried at each split: 248

        OOB estimate of  error rate: 16.67%
Confusion matrix:
             Luminal.A no.Luminal.A class.error
Luminal.A          259           20  0.07168459
no.Luminal.A        59          136  0.30256410</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Calcul des performances du modèle <em>random forest</em></li>
</ol>
<p>Pour comparer les performances de ce modèle, avec le modèle CART calculé précédemment, il faut calculer les performances du modèle <code>rf.fit</code> sur les données de l’échantillon d’apprentissage et de test.</p>
<ul>
<li>Calculez l’<em>accuracy</em> sur l’échantillon d’apprentissage.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pred.app &lt;-<span class="st"> </span><span class="kw">predict</span>(rf.fit, <span class="dt">newdata =</span> mat.app, <span class="dt">type=</span><span class="st">&quot;class&quot;</span>)</code></pre></div>
<ul>
<li>Calculez la matrice de confusion entre les données prédites sur l’échantillon d’apprentissage et les vraies valeurs.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tc.rf.app &lt;-<span class="st"> </span><span class="kw">table</span>(pred.app, mat.app[,<span class="st">&quot;cancer.type&quot;</span>])
tc.rf.app</code></pre></div>
<pre><code>              
pred.app       Luminal.A no.Luminal.A
  Luminal.A          279            0
  no.Luminal.A         0          195</code></pre>
<ul>
<li>Calculez l’<em>accuracy</em> du modèle sur les données de l’apprentissage</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">acc.rf.app &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">diag</span>(tc.rf.app))<span class="op">/</span><span class="kw">sum</span>(tc.rf.app)
acc.rf.app</code></pre></div>
<pre><code>[1] 1</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>Calcul de l’<em>accuracy</em> sur l’échantillon test</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pred.test &lt;-<span class="st"> </span><span class="kw">predict</span>(rf.fit, <span class="dt">newdata =</span> mat.test, <span class="dt">type=</span><span class="st">&quot;class&quot;</span>)

tc.rf.test &lt;-<span class="st"> </span><span class="kw">table</span>(pred.test, mat.test[,<span class="st">&quot;cancer.type&quot;</span>])
tc.rf.test</code></pre></div>
<pre><code>              
pred.test      Luminal.A no.Luminal.A
  Luminal.A          128           29
  no.Luminal.A        15           66</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">acc.rf.test &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">diag</span>(tc.rf.test))<span class="op">/</span><span class="kw">sum</span>(tc.rf.test)
acc.rf.test</code></pre></div>
<pre><code>[1] 0.8151261</code></pre>
<ol start="7" style="list-style-type: decimal">
<li>Etude de l’importance des variables (ici les gènes) dans le modèle.</li>
</ol>
<ul>
<li>Représentez graphiquement l’importance de chaque gène en utilisant la fonction <code>varImpPlot()</code></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">varImpPlot</span>(rf.fit, <span class="dt">n.var=</span><span class="dv">50</span>, <span class="dt">cex =</span> <span class="fl">0.7</span>, <span class="dt">type=</span><span class="dv">1</span>)</code></pre></div>
<p><img src="figures/07_tests_multiplesunnamed-chunk-35-1.png" width="672" style="display: block; margin: auto;" /></p>
<ul>
<li><p>Identifiez les gènes qui permettent de différentier le cancer Luminal.A des autres cancers.</p></li>
<li><p>Pour chaque gene sélectionné, tracez la distribution de l’expression du gène chez les patients atteints d’un cancer de type Luminal.A et chez les autres patients d’après les données d’apprentissage.</p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">v.imp &lt;-<span class="st"> </span><span class="kw">importance</span>(rf.fit)[,<span class="st">&quot;MeanDecreaseAccuracy&quot;</span>]
gene.sel &lt;-<span class="st"> </span><span class="kw">names</span>(<span class="kw">which</span>(v.imp<span class="op">&gt;</span><span class="dv">4</span>))

<span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">3</span>))
<span class="cf">for</span>(gene <span class="cf">in</span> gene.sel){
  <span class="kw">boxplot</span>(mat.app[,gene]<span class="op">~</span>mat.app[,<span class="dv">1</span>],<span class="dt">col=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>), <span class="dt">main=</span>gene)
}</code></pre></div>
<p><img src="figures/07_tests_multiplesunnamed-chunk-36-1.png" width="672" style="display: block; margin: auto;" /></p>
<ul>
<li>Représentez la matrice des données en focalisant sur les gènes sélectionnées et en utilisant une heatmap.</li>
</ul>
</div>
<div id="prediction-du-type-de-cancer-en-utilisant-les-support-vecteur-machines" class="section level1">
<h1><span class="header-section-number">6</span> Prédiction du type de cancer en utilisant les Support Vecteur Machines</h1>
<ul>
<li>utilisation avec formule R</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(e1071)
model=<span class="kw">svm</span>(cancer.type<span class="op">~</span>., <span class="dt">data=</span>mat.app)</code></pre></div>
<ul>
<li>utilisation classique</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">X=<span class="kw">subset</span>(mat.app, <span class="dt">select =</span> <span class="op">-</span>cancer.type)
y=mat.app<span class="op">$</span>cancer.type
model=<span class="kw">svm</span>(X,y)</code></pre></div>
<ul>
<li>erreur d’apprentissage avec les paramètres par défaut</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pred=<span class="kw">predict</span>(model, X)
<span class="kw">table</span>(pred, mat.app<span class="op">$</span>cancer.type)</code></pre></div>
<ul>
<li>surapprentissage avec gaussiennes très resserrées</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model=<span class="kw">svm</span>(X,y,<span class="dt">gamma=</span><span class="fl">0.1</span>)
pred=<span class="kw">predict</span>(model, X)
<span class="kw">table</span>(pred, mat.app<span class="op">$</span>cancer.type)</code></pre></div>
<ul>
<li>surapprentissage avec cost élevé</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model=<span class="kw">svm</span>(X,y,<span class="dt">cost=</span><span class="dv">100</span>)
pred=<span class="kw">predict</span>(model, X)
<span class="kw">table</span>(pred, mat.app<span class="op">$</span>cancer.type)</code></pre></div>
<ul>
<li>évaluation d’erreur de test (en surapprentissage)</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Xtest=<span class="kw">subset</span>(mat.test, <span class="dt">select =</span> <span class="op">-</span>cancer.type)
pred=<span class="kw">predict</span>(model, Xtest)
<span class="kw">table</span>(pred, mat.test<span class="op">$</span>cancer.type)</code></pre></div>
<ul>
<li>évaluation d’erreur de test (avec paramètres par défaut)</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model=<span class="kw">svm</span>(X,y)
pred=<span class="kw">predict</span>(model, Xtest)
<span class="kw">table</span>(pred, mat.test<span class="op">$</span>cancer.type)</code></pre></div>
</div>
<div id="prediction-des-echantillons-classes-comme-unclassified" class="section level1">
<h1><span class="header-section-number">7</span> Prédiction des échantillons classés comme “Unclassified”</h1>
<p>Lors de l’étude du jeu de données initial, vous avez déterminé que 107 échantillons avaient été classés comme “Unclassified”. En utilisant les modèles de <em>random forest</em> et de SVM, prédisez le type de cancer pour ces individus. Comparez les résultats obtenus avec les deux modèles.</p>
<ul>
<li>Prédiction du type de cancer en utilisant le modèle <em>random forest</em></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mat.pred &lt;-<span class="st"> </span><span class="kw">t</span>(BIC.expr)
pred.uncl.rf &lt;-<span class="st"> </span><span class="kw">predict</span>(rf.fit, <span class="dt">newdata =</span> mat.pred[ind.uncl,])
<span class="kw">table</span>(pred.uncl.rf)</code></pre></div>
<pre><code>pred.uncl.rf
   Luminal.A no.Luminal.A 
          53           54 </code></pre>
<ul>
<li>Prédiction du type de cancer en utilisant le modèle SVM</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pred.uncl.svm &lt;-<span class="st"> </span><span class="kw">predict</span>(model, <span class="dt">newdata =</span> mat.pred[ind.uncl,])
<span class="kw">table</span>(pred.uncl.svm)</code></pre></div>
<pre><code>pred.uncl.svm
   Luminal.A no.Luminal.A 
          61           46 </code></pre>
<ul>
<li>Calcul de la table de confusion entre les deux vecteurs de prédiction.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tc &lt;-<span class="st"> </span><span class="kw">table</span>(pred.uncl.rf, pred.uncl.svm)
tc</code></pre></div>
<pre><code>              pred.uncl.svm
pred.uncl.rf   Luminal.A no.Luminal.A
  Luminal.A           52            1
  no.Luminal.A         9           45</code></pre>
<p># Prédiction des 4 types de cancer.</p>
<ol style="list-style-type: decimal">
<li>Préparation du jeu de données</li>
</ol>
<p>Créez un nouveau data.frame (<code>df.data.4</code>) qui contient les données d’expression de gènes contenu dans le data.frame <code>BIC.expr.4</code> et le type de cancer pour chaque échantillon (définit en 4 types).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df.data.<span class="dv">4</span> &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">as.character</span>(BIC.sample.classes.<span class="dv">4</span>[,<span class="dv">1</span>]), <span class="kw">t</span>(BIC.expr.<span class="dv">4</span>))
df.data.<span class="dv">4</span>[,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">as.factor</span>(df.data.<span class="dv">4</span>[,<span class="dv">1</span>])
<span class="kw">colnames</span>(df.data.<span class="dv">4</span>)[<span class="dv">1</span>] &lt;-<span class="st"> &quot;cancer.type&quot;</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Préparation des échantillons d’apprentissage et de test</li>
</ol>
<ul>
<li>En reprenant les individus sélectionnés pour la création de l’échantillon d’apprentissage <code>ind.app</code>, créez les data.frames <code>mat.app.4</code> et <code>mat.test.4</code> qui contiennent les données de l’échantillon d’apprentissage et celui de test.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mat.app.<span class="dv">4</span> &lt;-<span class="st"> </span>df.data.<span class="dv">4</span>[ind.app,]
<span class="kw">dim</span>(mat.app.<span class="dv">4</span>)</code></pre></div>
<pre><code>[1] 474 965</code></pre>
<ul>
<li>Préparez l’échantillon test</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mat.test.<span class="dv">4</span> &lt;-<span class="st"> </span>df.data.<span class="dv">4</span>[<span class="op">-</span>ind.app,]
<span class="kw">dim</span>(mat.test.<span class="dv">4</span>)</code></pre></div>
<pre><code>[1] 238 965</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Déterminez les paramètres <code>mtry</code> et <code>ntree</code> optimaux pour le random forest permettant de prédire les 4 types de cancer.</li>
</ol>
<ul>
<li>Déterminez la valeur optimale du paramètre <code>ntree</code>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rf.fit.<span class="dv">4</span> &lt;-<span class="st"> </span><span class="kw">randomForest</span>(cancer.type<span class="op">~</span>., <span class="dt">data=</span>mat.app.<span class="dv">4</span>)
<span class="kw">plot</span>(rf.fit.<span class="dv">4</span><span class="op">$</span>err.rate[,<span class="dv">1</span>], <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;taux d&#39;erreur&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;nombre d&#39;arbres&quot;</span>)</code></pre></div>
<p><img src="figures/07_tests_multiplesunnamed-chunk-50-1.png" width="672" style="display: block; margin: auto;" /></p>
<ul>
<li>Déterminez la valeur optimale du paramètre <code>mtry</code></li>
</ul>
<p>```r v.err &lt;- NULL v.mtry &lt;- c(15, 31, 62, 124, 248, 350, 500) for(i in v.mtry){ set.seed(123) rf.fit &lt;- randomForest(cancer.type~., data = mat.app.4, ntree=150, mtry=i) v.err &lt;- c(v.err, rf.fit$err.rate[150,1]) }</p>
<p>plot(v.mtry, v.err, type =“b”, xlab=“mtry values”, ylab=“taux d’erreur”, xaxt=“n”) axis(1, at=v.mtry, labels=v.mtry, las=2) ```</p>
<p><img src="figures/07_tests_multiplesunnamed-chunk-51-1.png" width="672" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Calcul du modèle avec les paramètres optimaux.</li>
</ol>
<ul>
<li>Calculez à nouveau le modèle sur l’échantillon d’apprentissage en utilisant les valeurs optimales des paramètres <code>mtry</code> et <code>ntree</code>. Dans la fonction <code>randomForest()</code>, ajouter l’argument <code>importance=TRUE</code>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rf.fit.<span class="dv">4</span> &lt;-<span class="st"> </span><span class="kw">randomForest</span>(cancer.type<span class="op">~</span>., <span class="dt">data =</span> mat.app.<span class="dv">4</span>, <span class="dt">ntree=</span><span class="dv">150</span>, <span class="dt">mtry=</span><span class="dv">124</span>, <span class="dt">importance=</span><span class="ot">TRUE</span>)</code></pre></div>
<ul>
<li>Visualisez le modèle et la table de confusion obtenue sur les échantillons OOB.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rf.fit.<span class="dv">4</span></code></pre></div>
<pre><code>
Call:
 randomForest(formula = cancer.type ~ ., data = mat.app.4, ntree = 150,      mtry = 124, importance = TRUE) 
               Type of random forest: classification
                     Number of trees: 150
No. of variables tried at each split: 124

        OOB estimate of  error rate: 23.42%
Confusion matrix:
           Basal.like HER2pos Luminal.A Luminal.B class.error
Basal.like         74       1        12         0  0.14942529
HER2pos             9       5         8         7  0.82758621
Luminal.A           5       0       266         8  0.04659498
Luminal.B           0       0        61        18  0.77215190</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Calcul des performances du modèle <em>random forest</em> sur l’échantillon d’apprentissage et de test.</li>
</ol>
<ul>
<li>Calcul de l’<em>accuracy</em> sur l’échantillon d’apprentissage.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pred.app.<span class="dv">4</span> &lt;-<span class="st"> </span><span class="kw">predict</span>(rf.fit.<span class="dv">4</span>, <span class="dt">newdata =</span> mat.app.<span class="dv">4</span>, <span class="dt">type=</span><span class="st">&quot;class&quot;</span>)
tc.rf4.app &lt;-<span class="st"> </span><span class="kw">table</span>(pred.app.<span class="dv">4</span>, mat.app.<span class="dv">4</span>[,<span class="st">&quot;cancer.type&quot;</span>])
tc.rf4.app</code></pre></div>
<pre><code>            
pred.app.4   Basal.like HER2pos Luminal.A Luminal.B
  Basal.like         87       0         0         0
  HER2pos             0      29         0         0
  Luminal.A           0       0       279         0
  Luminal.B           0       0         0        79</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">acc.rf4.app &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">diag</span>(tc.rf4.app))<span class="op">/</span><span class="kw">sum</span>(tc.rf4.app)
acc.rf4.app</code></pre></div>
<pre><code>[1] 1</code></pre>
<ul>
<li>Calcul de l’<em>accuracy</em> sur l’échantillon test</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pred.test.<span class="dv">4</span> &lt;-<span class="st"> </span><span class="kw">predict</span>(rf.fit.<span class="dv">4</span>, <span class="dt">newdata =</span> mat.test.<span class="dv">4</span>, <span class="dt">type=</span><span class="st">&quot;class&quot;</span>)

tc.rf4.test &lt;-<span class="st"> </span><span class="kw">table</span>(pred.test.<span class="dv">4</span>, mat.test.<span class="dv">4</span>[,<span class="st">&quot;cancer.type&quot;</span>])
tc.rf4.test</code></pre></div>
<pre><code>            
pred.test.4  Basal.like HER2pos Luminal.A Luminal.B
  Basal.like         36       3         0         1
  HER2pos             0       3         0         0
  Luminal.A           8       4       139        30
  Luminal.B           0       2         4         8</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">acc.rf4.test &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">diag</span>(tc.rf4.test))<span class="op">/</span><span class="kw">sum</span>(tc.rf4.test)
acc.rf4.test</code></pre></div>
<pre><code>[1] 0.7815126</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>Etude de l’importance des descripteurs dans le modèle.</li>
</ol>
<ul>
<li>Représentez graphiquement la valeur d’importance des différents gènes en utilisant la fonction <code>varImpPlot()</code></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">varImpPlot</span>(rf.fit.<span class="dv">4</span>, <span class="dt">n.var=</span><span class="dv">50</span>, <span class="dt">cex =</span> <span class="fl">0.6</span>, <span class="dt">type=</span><span class="dv">1</span>)</code></pre></div>
<p><img src="figures/07_tests_multiplesunnamed-chunk-55-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
